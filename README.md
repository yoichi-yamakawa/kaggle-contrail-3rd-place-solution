# 3rd Place Solution of Google Research - Identify Contrails to Reduce Global Warming competition.
Below you can find a outline of how to reproduce Yiemon773's part for [Google Research - Identify Contrails to Reduce Global Warming competition](https://www.kaggle.com/competitions/google-research-identify-contrails-reduce-global-warming).

## ARCHIVE CONTENTS
- training codes
- preparing for prediction

### Remark 
Trained models for submission are not in this archive because of their file size.
The models are uploaded as kaggle public datasets. See the link below.

- exp166: https://www.kaggle.com/datasets/yoichi7yamakawa/exp166-maxvit-base-512-crop-5e4-2
- exp223: https://www.kaggle.com/datasets/yoichi7yamakawa/exp223-resnest269e-512-knpl-50ep
- exp227v2: https://www.kaggle.com/datasets/yoichi7yamakawa/exp227v2-maxvit-base-512-5e4-knpl
- exp228: https://www.kaggle.com/datasets/yoichi7yamakawa/exp228-effv2l-512-5e4-knpl-f4s-10
- exp234: https://www.kaggle.com/datasets/yoichi7yamakawa/exp234-resnest269e-512-5e4-p223
- exp237: https://www.kaggle.com/datasets/yoichi7yamakawa/exp237-maxvit-base-512-1e4-15ep
- exp240: https://www.kaggle.com/datasets/yoichi7yamakawa/exp240-resnest269e-512-1e4-p223
- exp241: https://www.kaggle.com/datasets/yoichi7yamakawa/exp241-maxvit-base-512-1e4-233-15
- exp243: https://www.kaggle.com/datasets/yoichi7yamakawa/exp243-effv2l-512-1e4-228-15ep
- exp247: https://www.kaggle.com/datasets/yoichi7yamakawa/exp247-effv2l-512-3e5-228-15ep

## Submission notebook 
https://www.kaggle.com/code/yoichi7yamakawa/later-sub-y-223-227v2-241-237-240-234-228etc?scriptVersionId=140674380

- Public Score 0.71659 
- Private Score 0.70956


## HARDWARE: (The following specs were used to create the original solution)
- Ubuntu 22.04 LTS (24 vCPUs, 128 GB memory)
- 4 x NVIDIA Tesla V100

## SOFTWARE
- Python 3.10.6
- CUDA 12.0
- cuddn 8.5.0.96-1+cuda11.7
- nvidia drivers 525.105.17

## DATA SETUP (assumes the [Kaggle API](https://github.com/Kaggle/kaggle-api) is installed)
<!-- #below are the shell commands used in each step, as run from the top level directory -->
- download data
```
mkdir p20-contrail
cd p20-contrail
kaggle competitions download -c google-research-identify-contrails-reduce-global-warming
```

- preprocessing data
1. prepare train.pkl, valid.pkl
```
import pandas as pd 

df_train_idx = pd.DataFrame({'record_id': os.listdir('p20-contrail/train/')})
df_valid_idx = pd.DataFrame({'record_id': os.listdir('p20-contrail/validation/')})

pd.to_pickle(df_train_idx, 'p20-contrail/train.pkl')
pd.to_pickle(df_train_idx, 'p20-contrail/valid.pkl')
```

2. prepare pseudo label : This dataset is generated by Kenshin Abe'(knshnb)s models. 
   Set the pseudo label data to `p20-contrail/pseudo-label/`. 

## Training 
1. setup environment
```
sh launch.sh
```

2. set experiment in `exp.sh` 
3. run training code
```
bash exp.sh
```

## Preparing datasets for prediction
In this section, we prepare prediction codes for kaggle environment

1. build and upload code
```
sh make_kaggle_data.sh
```

2. prediction (in kaggle notebook environment)
see prediction notebook: https://www.kaggle.com/code/yoichi7yamakawa/later-sub-y-223-227v2-241-237-240-234-228etc?scriptVersionId=140674380